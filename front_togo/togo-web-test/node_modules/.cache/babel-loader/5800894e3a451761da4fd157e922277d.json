{"ast":null,"code":"import _objectSpread from\"/home/system/togo-web-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/home/system/togo-web-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useState}from\"react\";import Address from\"../Address/Address\";import{Accordion,Card,Button}from\"react-bootstrap\";import{FinalizeOrder}from\"../OrdersManager/FinalizeOrder\";import{CancelOrder}from\"../OrdersManager/CancelOrder\";import{BidOrder}from\"../OrdersManager/AcceptOrder\";import{DeleteTripCost}from\"../OrdersManager/DeleteTripCost\";import{EditTripCost}from\"../OrdersManager/EditTripCost\";import Loader from\"../Loader/Loader\";import\"./OrderDetails.css\";import{getOrderDetails,checkTripCost,AcceptOfferReq,GetTransporterLocation}from\"../../APIs/OrdersAPIs\";import translate from\"../../i18n/translate\";import{Alert,AlertDescription,AlertIcon,AlertTitle}from\"@chakra-ui/alert\";import{Box}from\"@chakra-ui/layout\";import{deliverFormatter,packageFormatter}from\"../Orders/OrdersTabularView\";import{isTeamMember,isTransporter,isTransporterMaster}from\"../../Util\";import AssignToTransporter from\"../AssigneToTransporter\";import{useLocation,useParams,useHistory}from\"react-router\";import AssignToMemberOnNetworkDialog from\"../AssginToMemberOnNetworkDialog\";import{refreshPage}from\"../../Functions/CommonFunctions\";var Barcode=require('react-barcode');var OrderDetails=function OrderDetails(){var _useParams=useParams(),orderId=_useParams.id;var location=useLocation();var history=useHistory();var _useState=useState({}),_useState2=_slicedToArray(_useState,2),orderDetails=_useState2[0],setOrderDetails=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),previousPage=_useState4[0],setPreviousPage=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),tripCost=_useState6[0],setTripCost=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),costSet=_useState8[0],setCostSet=_useState8[1];var _useState9=useState({}),_useState10=_slicedToArray(_useState9,2),receiverAddress=_useState10[0],setReceiverAddress=_useState10[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),startTracking=_useState12[0],setStartTracking=_useState12[1];useEffect(function(){var live=false;if(startTracking===false){return;}var intervalId=setInterval(function(){if(!live){live=true;GetTransporterLocation(orderId).then(function(resp){live=false;var _resp$data$server_res=resp.data.server_response[0],TransporterLatLocation=_resp$data$server_res.TransporterLatLocation,TransporterLongLoc=_resp$data$server_res.TransporterLongLoc;if(TransporterLatLocation===null||TransporterLongLoc===null){TransporterLatLocation=0;TransporterLongLoc=0;}setReceiverAddress(_objectSpread(_objectSpread({},receiverAddress),{},{long:TransporterLongLoc,lat:TransporterLatLocation}));});}},4000);return function(){return clearInterval(intervalId);};},[startTracking]);useEffect(function(){var _location$state;checkTripCost(orderId,isTransporter()).then(function(tripCostRes){if(tripCostRes&&tripCostRes!==\"CostNotSend\"){setTripCost(isTransporter()?tripCostRes.server_response[0]:tripCostRes.CostDetail);setCostSet(true);}else{setCostSet(false);}});getOrderDetails(orderId).then(function(orderDetailsRes){setOrderDetails(orderDetailsRes);setReceiverAddress({otherDetails:orderDetailsRes.OtherDetailsDes,phoneCustomer:orderDetailsRes.ReceiverAddressNum,long:orderDetailsRes.LongReciver,lat:orderDetailsRes.LatReciver});});setPreviousPage((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.currentPage);},[]);if(typeof orderDetails===\"object\"&&JSON.stringify(orderDetails)!=='{}'){var deliveryWay=orderDetails.deliveryWay,HeightLoad=orderDetails.HeightLoad,DetailsLoad=orderDetails.DetailsLoad,LengthLoad=orderDetails.LengthLoad,WeightLoad=orderDetails.WeightLoad,WidthLoad=orderDetails.WidthLoad,OtherDetails=orderDetails.OtherDetails,TypeLoad=orderDetails.TypeLoad,PhoneCustomer=orderDetails.PhoneCustomer,LongSender=orderDetails.LongSender,LatSender=orderDetails.LatSender,AssignStatus=orderDetails.AssignStatus,AssignedMemberName=orderDetails.AssignedMemberName,isAcceptDelivery=orderDetails.isAcceptDelivery;var senderAddress={otherDetails:OtherDetails,phoneCustomer:PhoneCustomer,long:LongSender,lat:LatSender};return/*#__PURE__*/React.createElement(\"div\",{style:{marginRight:\"10%\",marginLeft:\"10%\",marginTop:\"5%\",overflowY:\"auto\"}},orderDetails&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"w-50\"},/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"w-250px\"},translate(\"ORDER_DETAILS.ORDER_NUMBER\")),/*#__PURE__*/React.createElement(\"span\",null,orderId)),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"w-250px\"},translate(\"ORDER_DETAILS.DELIVERY_TYPE\")),/*#__PURE__*/React.createElement(\"div\",null,deliverFormatter({DeliveryWays:deliveryWay}))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"w-250px\"},translate(\"ORDER_DETAILS.PACKAGE_TYPE\")),/*#__PURE__*/React.createElement(\"div\",null,packageFormatter({PackageType:TypeLoad}))),isTransporterMaster()&&AssignStatus===\"Assigned\"&&/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex\"},/*#__PURE__*/React.createElement(\"div\",{className:\"w-250px align-items-center\"},translate(\"ORDER_DETAILS.ASSIGNED\")),/*#__PURE__*/React.createElement(\"div\",null,AssignedMemberName)),TypeLoad!==\"1\"&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"w-250px\"},translate(\"ORDER_DETAILS.LOAD_HEIGHT\")),/*#__PURE__*/React.createElement(\"div\",null,HeightLoad||/*#__PURE__*/React.createElement(\"hr\",{style:{width:\"70px\"}}))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"w-250px\"},translate(\"ORDER_DETAILS.LOAD_WIDTH\")),/*#__PURE__*/React.createElement(\"div\",null,WidthLoad||/*#__PURE__*/React.createElement(\"hr\",{style:{width:\"70px\"}}))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"w-250px\"},translate(\"ORDER_DETAILS.LOAD_LENGTH\")),/*#__PURE__*/React.createElement(\"div\",null,LengthLoad||/*#__PURE__*/React.createElement(\"hr\",{style:{width:\"70px\"}}))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"w-250px\"},translate(\"ORDER_DETAILS.LOAD_WEIGHT\")),/*#__PURE__*/React.createElement(\"div\",null,WeightLoad||/*#__PURE__*/React.createElement(\"hr\",{style:{width:\"70px\"}}))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(\"div\",{className:\"w-250px\"},translate(\"ORDER_DETAILS.LOAD_DETAILS\")),/*#__PURE__*/React.createElement(\"div\",null,DetailsLoad||/*#__PURE__*/React.createElement(\"hr\",{style:{width:\"70px\"}}))))),/*#__PURE__*/React.createElement(\"div\",null,orderDetails.BarCode&&/*#__PURE__*/React.createElement(Barcode,{value:orderDetails.BarCode}),!orderDetails.BarCode&&/*#__PURE__*/React.createElement(Barcode,{value:orderId.padStart(8,0)}))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex\"},/*#__PURE__*/React.createElement(Accordion,{defaultActiveKey:\"0\",className:\"w-50 m-inline-e-2\"},/*#__PURE__*/React.createElement(Accordion.Item,{eventKey:\"0\",className:\"w-100\"},/*#__PURE__*/React.createElement(Accordion.Header,{as:\"div\"},translate(\"ORDER_DETAILS.SENDER_ADDRESS\")),/*#__PURE__*/React.createElement(Accordion.Body,null,/*#__PURE__*/React.createElement(Address,{address:senderAddress})))),/*#__PURE__*/React.createElement(Accordion,{defaultActiveKey:\"0\",className:\"w-50\"},/*#__PURE__*/React.createElement(Accordion.Item,{eventKey:\"0\",className:\"w-100\"},/*#__PURE__*/React.createElement(Accordion.Header,{as:\"div\"},/*#__PURE__*/React.createElement(\"div\",{className:\"flex-grow-1\"},translate(\"ORDER_DETAILS.RECEIVER_ADDRESS\")),isAcceptDelivery&&(isTransporterMaster()||!isTransporter())&&/*#__PURE__*/React.createElement(Button,{variant:\"outline-warning\",className:\"me-3 py-0\",onClick:function onClick(event){event.stopPropagation();setStartTracking(true);},size:\"sm\"},\"Track\")),/*#__PURE__*/React.createElement(Accordion.Body,null,/*#__PURE__*/React.createElement(Address,{address:receiverAddress}))))),/*#__PURE__*/React.createElement(Box,{mt:\"10px\"},previousPage===\"all-orders\"&&isTransporter()&&tripCost&&/*#__PURE__*/React.createElement(Card,{bg:\"Danger\",text:\"black\"},/*#__PURE__*/React.createElement(Card.Header,null,translate(\"ORDER_DETAILS.BID_PRICE\")),/*#__PURE__*/React.createElement(Card.Body,{className:\"d-flex align-items-center\"},tripCost.CostDelivery,/*#__PURE__*/React.createElement(\"div\",{className:\"ActionButtons ms-auto\"},/*#__PURE__*/React.createElement(DeleteTripCost,{orderId:orderId}),/*#__PURE__*/React.createElement(EditTripCost,{orderId:orderId,tripCost:tripCost.CostDelivery}))))),/*#__PURE__*/React.createElement(Box,{mt:\"10px\"},previousPage===\"all-orders\"&&!isTransporter()&&tripCost&&tripCost.length!==0&&/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Card,{bg:\"Danger\",text:\"black\"},/*#__PURE__*/React.createElement(Card.Header,null,translate(\"ORDERS.AVAILABLE_OFFERS\")),/*#__PURE__*/React.createElement(Card.Body,null,tripCost.map(function(costs){return/*#__PURE__*/React.createElement(\"div\",{className:\"align-items-center d-flex justify-content-between\"},/*#__PURE__*/React.createElement(\"img\",{className:\"w-25\",src:\"http://46.253.93.4/togo/MobileAPi/\".concat(costs.TransporterPersonalImg),alt:\"transImg\"}),/*#__PURE__*/React.createElement(\"div\",null,costs.TransporterName),/*#__PURE__*/React.createElement(Card.Title,null,costs.BidCost),/*#__PURE__*/React.createElement(Button,{className:\"btn-grad\",onClick:function onClick(){AcceptOfferReq(costs.IdTransporterBidRequist,orderId,costs.BidCost).then(function(resp){if(resp.data.indexOf(\"Success\")!==-1){refreshPage();}});}},\"Accept Offer\"));})))),previousPage===\"all-orders\"&&!isTransporter()&&/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex align-items-center\"},/*#__PURE__*/React.createElement(Button,{className:\"ms-auto my-2\",onClick:function onClick(){window.open(\"/account/bill-for-order/\"+orderId+\"?print=true\");}},translate(\"ORDER_DETAILS.PRINT\")),/*#__PURE__*/React.createElement(CancelOrder,{orderId:orderId,className:\"mx-1\",onSuccess:function onSuccess(){history.goBack();}})),previousPage===\"all-orders\"&&!costSet&&isTransporter()&&/*#__PURE__*/React.createElement(\"div\",{className:\"mt-2 d-inline-block float-end\"},/*#__PURE__*/React.createElement(BidOrder,{orderId:orderId})),previousPage===\"current-orders\"&&/*#__PURE__*/React.createElement(Box,{display:\"flex\",alignItems:\"center\",justifyContent:\"end\"},isTransporterMaster()&&AssignStatus!==\"Assigned\"&&/*#__PURE__*/React.createElement(AssignToTransporter,{onSuccess:function onSuccess(){getOrderDetails(orderId).then(function(orderDetailsRes){setOrderDetails(orderDetailsRes);});},orderId:orderId}),isTransporter()&&/*#__PURE__*/React.createElement(AssignToMemberOnNetworkDialog,{onSuccess:function onSuccess(){history.goBack();},orderId:orderId}),(isTeamMember()||isTransporter()&&!isTransporterMaster())&&/*#__PURE__*/React.createElement(\"div\",{className:\"ms-1\"},/*#__PURE__*/React.createElement(FinalizeOrder,{orderId:orderId}))))));}else if(typeof orderDetails===\"string\"){return/*#__PURE__*/React.createElement(Alert,{status:\"error\",w:\"80%\",m:\"10px auto\"},/*#__PURE__*/React.createElement(AlertIcon,null),/*#__PURE__*/React.createElement(AlertTitle,{mr:2},orderId),/*#__PURE__*/React.createElement(AlertDescription,null,orderDetails));}else{return/*#__PURE__*/React.createElement(Box,{height:\"400px\"},/*#__PURE__*/React.createElement(Loader,null));}};export default OrderDetails;","map":null,"metadata":{},"sourceType":"module"}