{"ast":null,"code":"import _slicedToArray from\"/home/system/togo-web-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useRef,useState}from\"react\";import{useEffect}from\"react\";import{Button,FormControl,Spinner}from\"react-bootstrap\";import{useHistory}from\"react-router-dom\";import{ActivateUser,ResendCode}from\"./APIs/LoginAPIs\";import{setAuth}from\"../Actions/GeneralActions\";import TogoContainer from\"./TogoContainer\";import{useDispatch}from\"react-redux\";var crypto=require('crypto');export default function ActivationCodeForm(){var firstNumRef=useRef();var dispatch=useDispatch();var secNumRef=useRef();var thirdNumRef=useRef();var forthNumRef=useRef();var _useState=useState(false),_useState2=_slicedToArray(_useState,2),disableResend=_useState2[0],setDisableResend=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loadingSubmit=_useState4[0],setLoadingSubmit=_useState4[1];var history=useHistory();useEffect(function(){var timer;if(disableResend){timer=setTimeout(function(){setDisableResend(false);},60000);}return function(){clearTimeout(timer);};},[disableResend]);return/*#__PURE__*/React.createElement(TogoContainer,null,/*#__PURE__*/React.createElement(\"p\",null,\"Please enter the activation code that was sent to Phone number \",localStorage.getItem(\"PhoneNumber\")),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex justify-content-evenly my-3\"},/*#__PURE__*/React.createElement(\"div\",{className:\"togo-outling\",style:{width:\"44px\"}},/*#__PURE__*/React.createElement(FormControl,{maxLength:1,onInput:function onInput(ev){ev.target.value=ev.target.value.replace(/[^0-9]/gi,\"\");},type:\"text\",className:\"rounded-circle text-center\",ref:firstNumRef})),/*#__PURE__*/React.createElement(\"div\",{className:\"togo-outling\",style:{width:\"44px\"}},/*#__PURE__*/React.createElement(FormControl,{maxLength:1,onInput:function onInput(ev){ev.target.value=ev.target.value.replace(/[^0-9]/gi,\"\");},type:\"text\",className:\"rounded-circle text-center\",ref:secNumRef})),/*#__PURE__*/React.createElement(\"div\",{className:\"togo-outling\",style:{width:\"44px\"}},/*#__PURE__*/React.createElement(FormControl,{maxLength:1,onInput:function onInput(ev){ev.target.value=ev.target.value.replace(/[^0-9]/gi,\"\");},type:\"text\",className:\"rounded-circle text-center\",ref:thirdNumRef})),/*#__PURE__*/React.createElement(\"div\",{className:\"togo-outling\",style:{width:\"44px\"}},/*#__PURE__*/React.createElement(FormControl,{maxLength:1,onInput:function onInput(ev){ev.target.value=ev.target.value.replace(/[^0-9]/gi,\"\");},type:\"text\",className:\"rounded-circle text-center\",ref:forthNumRef}))),/*#__PURE__*/React.createElement(\"div\",{className:\"d-flex justify-content-between\"},/*#__PURE__*/React.createElement(Button,{variant:\"\",disabled:disableResend,onClick:function onClick(){setDisableResend(true);ResendCode().then(function(){});}},\"Resend code\"),/*#__PURE__*/React.createElement(Button,{variant:\"\",onClick:function onClick(){history.push(\"/login\");}},\"Change mobile number\")),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Button,{variant:\"\",className:\"togo-button w-75 rounded-22\",disabled:loadingSubmit,onClick:function onClick(){setLoadingSubmit(true);var code=\"\".concat(firstNumRef.current.value).concat(secNumRef.current.value).concat(thirdNumRef.current.value).concat(forthNumRef.current.value);var currentTime=+new Date();var shasum=crypto.createHash('sha1').update(currentTime+\"\").digest('hex');ActivateUser(localStorage.getItem(\"RegPostCode\")+localStorage.getItem(\"PhoneNumber\"),code,shasum).then(function(res){var _res$data$server_resp;var userInfo=(_res$data$server_resp=res.data.server_response)===null||_res$data$server_resp===void 0?void 0:_res$data$server_resp[0];if(userInfo){localStorage.setItem(\"userId\",userInfo.id);localStorage.setItem(\"TokenDevice\",shasum);localStorage.setItem(\"UserType\",userInfo.IsClient===\"1\"?\"client\":\"transporter\");dispatch(setAuth(true));}if(userInfo.FlagRegistration===\"ClientPersonalInfo\"){//\"ClientRegistration\"\nhistory.push(\"/personal-info\");return;}//TransporterPersonalInfo\n//TrsnsporterCarInfo\n//TransporterWorkCityInfo\n//TransporterWorkTimeInfo\n//TransporterCompletedRegistration\n// localStorage.setItem(\"IsTransporterMaster\", response.data.ResultArray[0].IsTransporterMaster);\n// localStorage.setItem(\"IsTeamMember\", response.data.ResultArray[0].IsTeamMember)\nsetLoadingSubmit(false);history.push(\"/dashboard\");});}},loadingSubmit&&/*#__PURE__*/React.createElement(Spinner,{animation:\"border\",size:\"sm\"}),\"Accept\")));}","map":{"version":3,"sources":["/home/system/togo-web-test/src/components/ActivationCodeForm.jsx"],"names":["React","useRef","useState","useEffect","Button","FormControl","Spinner","useHistory","ActivateUser","ResendCode","setAuth","TogoContainer","useDispatch","crypto","require","ActivationCodeForm","firstNumRef","dispatch","secNumRef","thirdNumRef","forthNumRef","disableResend","setDisableResend","loadingSubmit","setLoadingSubmit","history","timer","setTimeout","clearTimeout","localStorage","getItem","width","ev","target","value","replace","then","push","code","current","currentTime","Date","shasum","createHash","update","digest","res","userInfo","data","server_response","setItem","id","IsClient","FlagRegistration"],"mappings":"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","sourcesContent":["import React, { useRef, useState } from \"react\";\r\nimport { useEffect } from \"react\";\r\n\r\nimport { Button, FormControl, Spinner } from \"react-bootstrap\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport { ActivateUser, ResendCode } from \"./APIs/LoginAPIs\";\r\nimport { setAuth } from \"../Actions/GeneralActions\";\r\nimport TogoContainer from \"./TogoContainer\";\r\nimport { useDispatch } from \"react-redux\";\r\n\r\nvar crypto = require('crypto');\r\n\r\nexport default function ActivationCodeForm(){\r\n    const firstNumRef = useRef();\r\n    const dispatch = useDispatch();\r\n    const secNumRef = useRef();\r\n    const thirdNumRef = useRef();\r\n    const forthNumRef = useRef();\r\n    const [disableResend, setDisableResend] = useState(false);\r\n    const [loadingSubmit, setLoadingSubmit] = useState(false);\r\n    const history = useHistory();\r\n\r\n    useEffect(()=>{\r\n        let timer;\r\n        if(disableResend){\r\n            timer = setTimeout(()=>{\r\n                setDisableResend(false)\r\n            }, 60000);\r\n        }\r\n        return () => {\r\n            clearTimeout(timer);\r\n        }\r\n    }, [disableResend]);\r\n\r\n    return (\r\n        <TogoContainer>\r\n            <p>Please enter the activation code that was sent to Phone number {localStorage.getItem(\"PhoneNumber\")}</p>\r\n            <div className=\"d-flex justify-content-evenly my-3\">\r\n                <div className=\"togo-outling\" style={{width: \"44px\"}}>\r\n                    <FormControl\r\n                        maxLength={1}\r\n                        onInput={(ev)=>{\r\n                            ev.target.value = ev.target.value.replace(/[^0-9]/gi, \"\");\r\n                        }}\r\n                        type=\"text\"\r\n                        className=\"rounded-circle text-center\"\r\n                        ref={firstNumRef}\r\n                    />\r\n                </div>\r\n                <div className=\"togo-outling\" style={{width: \"44px\"}}>\r\n                    <FormControl\r\n                        maxLength={1}\r\n                        onInput={(ev)=>{\r\n                            ev.target.value = ev.target.value.replace(/[^0-9]/gi, \"\");\r\n                        }}\r\n                        type=\"text\"\r\n                        className=\"rounded-circle text-center\"\r\n                        ref={secNumRef}\r\n                    />\r\n                </div>\r\n                <div className=\"togo-outling\" style={{width: \"44px\"}}>\r\n                    <FormControl\r\n                        maxLength={1}\r\n                        onInput={(ev)=>{\r\n                            ev.target.value = ev.target.value.replace(/[^0-9]/gi, \"\");\r\n                        }}\r\n                        type=\"text\"\r\n                        className=\"rounded-circle text-center\"\r\n                        ref={thirdNumRef}\r\n                    />\r\n                </div>\r\n                <div className=\"togo-outling\" style={{width: \"44px\"}}>\r\n                    <FormControl\r\n                        maxLength={1}\r\n                        onInput={(ev)=>{\r\n                            ev.target.value = ev.target.value.replace(/[^0-9]/gi, \"\");\r\n                        }}\r\n                        type=\"text\"\r\n                        className=\"rounded-circle text-center\"\r\n                        ref={forthNumRef}\r\n                    />\r\n                </div>\r\n            </div>\r\n            <div className=\"d-flex justify-content-between\">\r\n                <Button variant=\"\" disabled={disableResend} onClick={()=>{\r\n                    setDisableResend(true);\r\n                    ResendCode().then(()=>{\r\n\r\n                    });\r\n                }}>\r\n                    Resend code\r\n                </Button>\r\n                <Button variant=\"\" onClick={()=>{\r\n                    history.push(\"/login\");\r\n                }}>\r\n                    Change mobile number\r\n                </Button>\r\n            </div>\r\n            <div>\r\n                <Button\r\n                    variant=\"\"\r\n                    className=\"togo-button w-75 rounded-22\"\r\n                    disabled={loadingSubmit}\r\n                    onClick={()=>{\r\n                        setLoadingSubmit(true);\r\n                        let code = `${firstNumRef.current.value}${secNumRef.current.value}${thirdNumRef.current.value}${forthNumRef.current.value}`;\r\n                        const currentTime = +(new Date());\r\n                        var shasum = crypto.createHash('sha1').update(currentTime + \"\").digest('hex');\r\n\r\n                        ActivateUser(localStorage.getItem(\"RegPostCode\") + localStorage.getItem(\"PhoneNumber\"), code, shasum).then((res)=>{\r\n                            const userInfo = res.data.server_response?.[0];\r\n\r\n                            if(userInfo){\r\n                                localStorage.setItem(\"userId\", userInfo.id);\r\n                                localStorage.setItem(\"TokenDevice\", shasum);\r\n                                localStorage.setItem(\"UserType\", userInfo.IsClient === \"1\" ? \"client\" : \"transporter\");\r\n                                dispatch(setAuth(true));\r\n                            }\r\n                            if(userInfo.FlagRegistration === \"ClientPersonalInfo\"){ //\"ClientRegistration\"\r\n                                history.push(\"/personal-info\");\r\n                                return;\r\n                            }\r\n                            //TransporterPersonalInfo\r\n                            //TrsnsporterCarInfo\r\n                            //TransporterWorkCityInfo\r\n                            //TransporterWorkTimeInfo\r\n                            //TransporterCompletedRegistration\r\n                            \r\n                            // localStorage.setItem(\"IsTransporterMaster\", response.data.ResultArray[0].IsTransporterMaster);\r\n                            // localStorage.setItem(\"IsTeamMember\", response.data.ResultArray[0].IsTeamMember)\r\n                            setLoadingSubmit(false);\r\n                            history.push(\"/dashboard\");\r\n                        })\r\n                    }}\r\n                >\r\n                    {loadingSubmit && <Spinner animation=\"border\" size=\"sm\"/>}\r\n                    Accept\r\n                </Button>\r\n            </div>\r\n        </TogoContainer>\r\n    )\r\n}\r\n"]},"metadata":{},"sourceType":"module"}