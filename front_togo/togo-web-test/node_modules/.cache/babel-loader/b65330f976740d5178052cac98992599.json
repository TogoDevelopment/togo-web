{"ast":null,"code":"import _slicedToArray from \"/home/system/togo-web-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/system/togo-web-test/src/components/FinancialManagement.jsx\";\nimport React, { useEffect, useRef, useState } from 'react';\nimport translate from \"../i18n/translate\";\nimport { getCustomerWithdrawRequests, requestWithdraw } from '../APIs/financialsAPIs';\nimport Loader from \"./Loader/Loader\";\nimport { Box } from \"@chakra-ui/layout\";\nimport BootstrapTable from 'react-bootstrap-table-next';\nimport paginationFactory from 'react-bootstrap-table2-paginator';\nimport filterFactory from 'react-bootstrap-table2-filter';\nimport { Button, Badge, Modal, Form, FloatingLabel, Spinner } from \"react-bootstrap\";\nimport { useDispatch } from \"react-redux\";\nimport { toastNotification } from \"../Actions/GeneralActions\";\nimport { useIntl } from \"react-intl\";\nimport { GiReceiveMoney } from 'react-icons/gi';\n/* display cancel button if the request is wating */\n\nfunction cancelFormatter(value) {\n  return /*#__PURE__*/React.createElement(React.Fragment, null, value == 1 && /*#__PURE__*/React.createElement(Button, {\n    variant: \"danger\",\n    style: {\n      fontSize: \"0.7rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 18,\n      columnNumber: 24\n    }\n  }, translate(\"WITHDRAW_REQUEST.CANCEL_REQUEST\")));\n}\n/* format each request status */\n\n\nfunction statusFormatter(value) {\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Badge, {\n    bg: value == \"WAITING\" ? \"warning\" : value == \"FINISHED\" ? \"success\" : \"danger\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 27,\n      columnNumber: 9\n    }\n  }, translate(\"WITHDRAW_REQUEST.\" + value)));\n}\n/* format each request amount */\n\n\nfunction amountFormatter(value) {\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n    style: {\n      color: \"#26a69a\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 35,\n      columnNumber: 14\n    }\n  }, value), \" \", \" NIS\");\n}\n/* time formatter, to convert from 24 hrs system to 12 hrs system */\n\n\nfunction timeFormatter(value) {\n  var tempStr = value.split(\":\");\n  var time = value;\n  if (tempStr[0].length === 1) time = \"0\".concat(value); // Check correct time format and split into components\n\n  time = time.toString().match(/^([01]\\d|2[0-3])(:)([0-5]\\d)(:[0-5]\\d)?$/) || [time];\n\n  if (time.length > 1) {\n    // If time format correct\n    time = time.slice(1); // Remove full string match value\n\n    time[5] = +time[0] < 12 ? ' AM' : ' PM'; // Set AM/PM\n\n    time[0] = +time[0] % 12 || 12; // Adjust hours\n  }\n\n  return time.join(''); // return adjusted time or original string\n}\n\nexport default function FinancialManagement() {\n  var dispatch = useDispatch();\n  var intl = useIntl();\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      loadinRequest = _useState2[0],\n      setLoadinRequest = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      refresh = _useState4[0],\n      setRefresh = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      requests = _useState6[0],\n      setRequests = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      isEmpty = _useState8[0],\n      setIsEmpty = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      showRequestModal = _useState10[0],\n      setShowRequestModal = _useState10[1];\n\n  var handleCloseRequestModal = function handleCloseRequestModal() {\n    return setShowRequestModal(false);\n  };\n\n  var handleShowRequestModal = function handleShowRequestModal() {\n    return setShowRequestModal(true);\n  };\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      validated = _useState12[0],\n      setValidated = _useState12[1];\n  /* get all related withdrawal requests to be displayed in the table */\n\n\n  useEffect(function () {\n    var isMounted = true;\n    getCustomerWithdrawRequests().then(function (res) {\n      if (!!!res.data.server_response) {\n        if (res.data.includes('error')) dispatch(toastNotification(\"Error\", res.data, \"error\"));\n      } else {\n        var tempArr = [];\n        var resArr = res.data.server_response;\n\n        for (var i = 0; i < resArr.length; i++) {\n          tempArr.push({\n            \"id\": resArr[i].id,\n            \"date\": resArr[i].requestTime.split(\" \")[0],\n            \"time\": resArr[i].requestTime.split(\" \")[1],\n            \"amount\": resArr[i].amount,\n            \"status\": resArr[i].isCanceled == 1 ? \"CANCELED\" : resArr[i].isRejected == 1 ? \"REJECTED\" : resArr[i].isApproved == 1 ? \"FINISHED\" : \"WAITING\",\n            \"isActive\": resArr[i].isCanceled == 1 || resArr[i].isRejected == 1 || resArr[i].isApproved == 1 ? 0 : 1\n          });\n        }\n\n        if (isMounted) {\n          setRequests(tempArr);\n\n          if (tempArr.length > 0) {\n            setIsEmpty(false);\n          } else {\n            setIsEmpty(true);\n          }\n        }\n      }\n    });\n    return function () {\n      isMounted = false;\n    };\n  }, [refresh]);\n  /* table columns */\n\n  var columns = [{\n    dataField: 'date',\n    text: intl.formatMessage({\n      id: \"WITHDRAW_REQUEST.REQUEST_DATE\"\n    })\n  }, {\n    dataField: 'time',\n    text: intl.formatMessage({\n      id: \"WITHDRAW_REQUEST.REQUEST_TIME\"\n    }),\n    formatter: timeFormatter\n  }, {\n    dataField: 'amount',\n    text: intl.formatMessage({\n      id: \"WITHDRAW_REQUEST.WITHDRAWAL_AMOUNT\"\n    }),\n    formatter: amountFormatter\n  }, {\n    dataField: 'status',\n    text: intl.formatMessage({\n      id: \"WITHDRAW_REQUEST.STATUS\"\n    }),\n    formatter: statusFormatter\n  }\n  /* ,\r\n  {\r\n     dataField: 'isActive',\r\n     text: \"\",\r\n     formatter: cancelFormatter\r\n  } */\n  ];\n  /* clear the borders for table headers */\n\n  for (var i = 0; i < columns.length; i++) {\n    columns[i].headerStyle = {\n      border: 'none'\n    };\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"pe-4 ps-4 pt-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    className: \"btn-grad mt-2 mb-3 d-flex justify-content-center\",\n    onClick: handleShowRequestModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 13\n    }\n  }, translate(\"WITHDRAW_REQUEST.REQUEST_WITHDRAWAL\"), /*#__PURE__*/React.createElement(GiReceiveMoney, {\n    className: \"ms-2 mt-1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 145,\n      columnNumber: 17\n    }\n  })), /*#__PURE__*/React.createElement(Modal, {\n    className: \"togo-custom-modal-lg\",\n    centered: true,\n    show: showRequestModal,\n    onHide: handleCloseRequestModal,\n    backdrop: \"static\",\n    keyboard: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Modal.Header, {\n    closeButton: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 21\n    }\n  }, translate(\"WITHDRAW_REQUEST.REQUEST_WITHDRAW\"))), /*#__PURE__*/React.createElement(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Form, {\n    id: \"amountForm\",\n    validated: validated,\n    noValidate: true,\n    onSubmit: function onSubmit(event) {\n      event.preventDefault();\n      event.stopPropagation();\n      var formData = new FormData(event.target),\n          formDataObj = Object.fromEntries(formData.entries());\n      var form = event.currentTarget;\n\n      if (form.checkValidity() === true) {\n        setLoadinRequest(true);\n        requestWithdraw(formDataObj.amount).then(function (res) {\n          if (res.data.includes('error')) {\n            dispatch(toastNotification(\"Error\", res.data, \"error\"));\n          } else {\n            setLoadinRequest(false);\n            handleCloseRequestModal();\n            setRefresh(!refresh);\n          }\n        });\n      }\n\n      setValidated(true);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(FloatingLabel, {\n    controlId: \"floatingAmount\",\n    label: intl.formatMessage({\n      id: \"WITHDRAW_REQUEST.AMOUNT\"\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Form.Control, {\n    required: true,\n    type: \"number\",\n    placeholder: \"...\",\n    name: \"amount\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 186,\n      columnNumber: 29\n    }\n  })), /*#__PURE__*/React.createElement(\"hr\", {\n    className: \"my-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 25\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex justify-content-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    style: {\n      width: \"45%\"\n    },\n    variant: \"outline-secondary\",\n    onClick: handleCloseRequestModal,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 29\n    }\n  }, translate(\"WITHDRAW_REQUEST.CANCEL\")), /*#__PURE__*/React.createElement(Button, {\n    type: \"submit\",\n    style: {\n      width: \"45%\"\n    },\n    disabled: loadinRequest ? true : false,\n    className: \"btn-grad\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 29\n    }\n  }, translate(\"WITHDRAW_REQUEST.SEND_REQUEST\"), loadinRequest && /*#__PURE__*/React.createElement(Spinner, {\n    animation: \"border\",\n    size: \"sm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 51\n    }\n  })))))), requests.length > 0 ? /*#__PURE__*/React.createElement(BootstrapTable, {\n    keyField: \"id\",\n    data: requests,\n    columns: columns,\n    pagination: paginationFactory(),\n    rowClasses: \"custom-row-class\",\n    columnClasses: \"custom-column-class\",\n    filter: filterFactory(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 21\n    }\n  }) : !isEmpty ? /*#__PURE__*/React.createElement(Box, {\n    height: \"400px\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(Loader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 57\n    }\n  })) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"w-100 d-flex justify-content-center mt-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 25\n    }\n  }, translate(\"WITHDRAW_REQUEST.NO_REQUESTS\")));\n}\n;","map":{"version":3,"sources":["/home/system/togo-web-test/src/components/FinancialManagement.jsx"],"names":["React","useEffect","useRef","useState","translate","getCustomerWithdrawRequests","requestWithdraw","Loader","Box","BootstrapTable","paginationFactory","filterFactory","Button","Badge","Modal","Form","FloatingLabel","Spinner","useDispatch","toastNotification","useIntl","GiReceiveMoney","cancelFormatter","value","fontSize","statusFormatter","amountFormatter","color","timeFormatter","tempStr","split","time","length","concat","toString","match","slice","join","FinancialManagement","dispatch","intl","loadinRequest","setLoadinRequest","refresh","setRefresh","requests","setRequests","isEmpty","setIsEmpty","showRequestModal","setShowRequestModal","handleCloseRequestModal","handleShowRequestModal","validated","setValidated","isMounted","then","res","data","server_response","includes","tempArr","resArr","i","push","id","requestTime","amount","isCanceled","isRejected","isApproved","columns","dataField","text","formatMessage","formatter","headerStyle","border","event","preventDefault","stopPropagation","formData","FormData","target","formDataObj","Object","fromEntries","entries","form","currentTarget","checkValidity","width"],"mappings":";;AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,MAA3B,EAAmCC,QAAnC,QAAmD,OAAnD;AACA,OAAOC,SAAP,MAAsB,mBAAtB;AACA,SAASC,2BAAT,EAAsCC,eAAtC,QAA6D,wBAA7D;AACA,OAAOC,MAAP,MAAmB,iBAAnB;AACA,SAASC,GAAT,QAAoB,mBAApB;AACA,OAAOC,cAAP,MAA2B,4BAA3B;AACA,OAAOC,iBAAP,MAA8B,kCAA9B;AACA,OAAOC,aAAP,MAA0B,+BAA1B;AACA,SAASC,MAAT,EAAiBC,KAAjB,EAAwBC,KAAxB,EAA+BC,IAA/B,EAAqCC,aAArC,EAAoDC,OAApD,QAAmE,iBAAnE;AACA,SAASC,WAAT,QAA4B,aAA5B;AACA,SAASC,iBAAT,QAAkC,2BAAlC;AACA,SAASC,OAAT,QAAwB,YAAxB;AACA,SAASC,cAAT,QAA+B,gBAA/B;AAEA;;AACA,SAASC,eAAT,CAAyBC,KAAzB,EAAgC;AAC5B,sBAAO,0CACFA,KAAK,IAAI,CAAT,iBAAc,oBAAC,MAAD;AAAQ,IAAA,OAAO,EAAC,QAAhB;AAAyB,IAAA,KAAK,EAAE;AAAEC,MAAAA,QAAQ,EAAE;AAAZ,KAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACVpB,SAAS,CAAC,iCAAD,CADC,CADZ,CAAP;AAKH;AAED;;;AACA,SAASqB,eAAT,CAAyBF,KAAzB,EAAgC;AAC5B,sBAAO,uDACH,oBAAC,KAAD;AAAO,IAAA,EAAE,EAAEA,KAAK,IAAI,SAAT,GAAqB,SAArB,GAAiCA,KAAK,IAAI,UAAT,GAAsB,SAAtB,GAAkC,QAA9E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACKnB,SAAS,CAAC,sBAAsBmB,KAAvB,CADd,CADG,CAAP;AAKH;AAED;;;AACA,SAASG,eAAT,CAAyBH,KAAzB,EAAgC;AAC5B,sBAAO,uDAAE;AAAM,IAAA,KAAK,EAAE;AAAEI,MAAAA,KAAK,EAAE;AAAT,KAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAoCJ,KAApC,CAAF,OAAqD,MAArD,CAAP;AACH;AAED;;;AACA,SAASK,aAAT,CAAuBL,KAAvB,EAA8B;AAC1B,MAAMM,OAAO,GAAGN,KAAK,CAACO,KAAN,CAAY,GAAZ,CAAhB;AACA,MAAIC,IAAI,GAAGR,KAAX;AACA,MAAIM,OAAO,CAAC,CAAD,CAAP,CAAWG,MAAX,KAAsB,CAA1B,EACID,IAAI,GAAG,IAAIE,MAAJ,CAAWV,KAAX,CAAP,CAJsB,CAM1B;;AACAQ,EAAAA,IAAI,GAAGA,IAAI,CAACG,QAAL,GAAgBC,KAAhB,CAAsB,0CAAtB,KAAqE,CAACJ,IAAD,CAA5E;;AAEA,MAAIA,IAAI,CAACC,MAAL,GAAc,CAAlB,EAAqB;AAAE;AACnBD,IAAAA,IAAI,GAAGA,IAAI,CAACK,KAAL,CAAW,CAAX,CAAP,CADiB,CACM;;AACvBL,IAAAA,IAAI,CAAC,CAAD,CAAJ,GAAU,CAACA,IAAI,CAAC,CAAD,CAAL,GAAW,EAAX,GAAgB,KAAhB,GAAwB,KAAlC,CAFiB,CAEwB;;AACzCA,IAAAA,IAAI,CAAC,CAAD,CAAJ,GAAU,CAACA,IAAI,CAAC,CAAD,CAAL,GAAW,EAAX,IAAiB,EAA3B,CAHiB,CAGc;AAClC;;AACD,SAAOA,IAAI,CAACM,IAAL,CAAU,EAAV,CAAP,CAd0B,CAcJ;AACzB;;AAED,eAAe,SAASC,mBAAT,GAA+B;AAE1C,MAAIC,QAAQ,GAAGrB,WAAW,EAA1B;AACA,MAAMsB,IAAI,GAAGpB,OAAO,EAApB;;AACA,kBAA0CjB,QAAQ,CAAC,KAAD,CAAlD;AAAA;AAAA,MAAOsC,aAAP;AAAA,MAAsBC,gBAAtB;;AACA,mBAA8BvC,QAAQ,CAAC,KAAD,CAAtC;AAAA;AAAA,MAAOwC,OAAP;AAAA,MAAgBC,UAAhB;;AACA,mBAAgCzC,QAAQ,CAAC,EAAD,CAAxC;AAAA;AAAA,MAAO0C,QAAP;AAAA,MAAiBC,WAAjB;;AACA,mBAA8B3C,QAAQ,CAAC,KAAD,CAAtC;AAAA;AAAA,MAAO4C,OAAP;AAAA,MAAgBC,UAAhB;;AACA,mBAAgD7C,QAAQ,CAAC,KAAD,CAAxD;AAAA;AAAA,MAAO8C,gBAAP;AAAA,MAAyBC,mBAAzB;;AACA,MAAMC,uBAAuB,GAAG,SAA1BA,uBAA0B;AAAA,WAAMD,mBAAmB,CAAC,KAAD,CAAzB;AAAA,GAAhC;;AACA,MAAME,sBAAsB,GAAG,SAAzBA,sBAAyB;AAAA,WAAMF,mBAAmB,CAAC,IAAD,CAAzB;AAAA,GAA/B;;AACA,oBAAkC/C,QAAQ,CAAC,KAAD,CAA1C;AAAA;AAAA,MAAOkD,SAAP;AAAA,MAAkBC,YAAlB;AAEA;;;AACArD,EAAAA,SAAS,CAAC,YAAM;AACZ,QAAIsD,SAAS,GAAG,IAAhB;AACAlD,IAAAA,2BAA2B,GAAGmD,IAA9B,CAAmC,UAACC,GAAD,EAAS;AAExC,UAAI,CAAC,CAAC,CAACA,GAAG,CAACC,IAAJ,CAASC,eAAhB,EAAiC;AAC7B,YAAIF,GAAG,CAACC,IAAJ,CAASE,QAAT,CAAkB,OAAlB,CAAJ,EACIrB,QAAQ,CAACpB,iBAAiB,CAAC,OAAD,EAAUsC,GAAG,CAACC,IAAd,EAAoB,OAApB,CAAlB,CAAR;AACP,OAHD,MAGO;AACH,YAAMG,OAAO,GAAG,EAAhB;AACA,YAAMC,MAAM,GAAGL,GAAG,CAACC,IAAJ,CAASC,eAAxB;;AAEA,aAAK,IAAII,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAAM,CAAC9B,MAA3B,EAAmC+B,CAAC,EAApC,EAAwC;AACpCF,UAAAA,OAAO,CAACG,IAAR,CAAa;AACT,kBAAMF,MAAM,CAACC,CAAD,CAAN,CAAUE,EADP;AAET,oBAAQH,MAAM,CAACC,CAAD,CAAN,CAAUG,WAAV,CAAsBpC,KAAtB,CAA4B,GAA5B,EAAiC,CAAjC,CAFC;AAGT,oBAAQgC,MAAM,CAACC,CAAD,CAAN,CAAUG,WAAV,CAAsBpC,KAAtB,CAA4B,GAA5B,EAAiC,CAAjC,CAHC;AAIT,sBAAUgC,MAAM,CAACC,CAAD,CAAN,CAAUI,MAJX;AAKT,sBAAUL,MAAM,CAACC,CAAD,CAAN,CAAUK,UAAV,IAAwB,CAAxB,GAA4B,UAA5B,GAAyCN,MAAM,CAACC,CAAD,CAAN,CAAUM,UAAV,IAAwB,CAAxB,GAA4B,UAA5B,GAAyCP,MAAM,CAACC,CAAD,CAAN,CAAUO,UAAV,IAAwB,CAAxB,GAA4B,UAA5B,GAAyC,SAL5H;AAMT,wBAAaR,MAAM,CAACC,CAAD,CAAN,CAAUK,UAAV,IAAwB,CAAxB,IAA6BN,MAAM,CAACC,CAAD,CAAN,CAAUM,UAAV,IAAwB,CAArD,IAA0DP,MAAM,CAACC,CAAD,CAAN,CAAUO,UAAV,IAAwB,CAAnF,GAAwF,CAAxF,GAA4F;AAN/F,WAAb;AAQH;;AAED,YAAIf,SAAJ,EAAe;AACXT,UAAAA,WAAW,CAACe,OAAD,CAAX;;AAGA,cAAIA,OAAO,CAAC7B,MAAR,GAAiB,CAArB,EAAwB;AACpBgB,YAAAA,UAAU,CAAC,KAAD,CAAV;AACH,WAFD,MAEO;AACHA,YAAAA,UAAU,CAAC,IAAD,CAAV;AACH;AACJ;AACJ;AAEJ,KAhCD;AAiCA,WAAO,YAAM;AAAEO,MAAAA,SAAS,GAAG,KAAZ;AAAmB,KAAlC;AACH,GApCQ,EAoCN,CAACZ,OAAD,CApCM,CAAT;AAsCA;;AACA,MAAM4B,OAAO,GAAG,CACZ;AACIC,IAAAA,SAAS,EAAE,MADf;AAEIC,IAAAA,IAAI,EAAEjC,IAAI,CAACkC,aAAL,CAAmB;AAAET,MAAAA,EAAE,EAAE;AAAN,KAAnB;AAFV,GADY,EAKZ;AACIO,IAAAA,SAAS,EAAE,MADf;AAEIC,IAAAA,IAAI,EAAEjC,IAAI,CAACkC,aAAL,CAAmB;AAAET,MAAAA,EAAE,EAAE;AAAN,KAAnB,CAFV;AAGIU,IAAAA,SAAS,EAAE/C;AAHf,GALY,EAUZ;AACI4C,IAAAA,SAAS,EAAE,QADf;AAEIC,IAAAA,IAAI,EAAEjC,IAAI,CAACkC,aAAL,CAAmB;AAAET,MAAAA,EAAE,EAAE;AAAN,KAAnB,CAFV;AAGIU,IAAAA,SAAS,EAAEjD;AAHf,GAVY,EAeZ;AACI8C,IAAAA,SAAS,EAAE,QADf;AAEIC,IAAAA,IAAI,EAAEjC,IAAI,CAACkC,aAAL,CAAmB;AAAET,MAAAA,EAAE,EAAE;AAAN,KAAnB,CAFV;AAGIU,IAAAA,SAAS,EAAElD;AAHf;AAIC;AACT;AACA;AACA;AACA;AACA;AAxBoB,GAAhB;AA2BA;;AACA,OAAK,IAAIsC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGQ,OAAO,CAACvC,MAA5B,EAAoC+B,CAAC,EAArC,EAAyC;AACrCQ,IAAAA,OAAO,CAACR,CAAD,CAAP,CAAWa,WAAX,GAAyB;AAAEC,MAAAA,MAAM,EAAE;AAAV,KAAzB;AACH;;AAED,sBACI;AAAK,IAAA,SAAS,EAAC,gBAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,MAAD;AAAQ,IAAA,SAAS,EAAC,kDAAlB;AAAqE,IAAA,OAAO,EAAEzB,sBAA9E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACKhD,SAAS,CAAC,qCAAD,CADd,eAEI,oBAAC,cAAD;AAAgB,IAAA,SAAS,EAAE,WAA3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFJ,CADJ,eAOI,oBAAC,KAAD;AACI,IAAA,SAAS,EAAC,sBADd;AAEI,IAAA,QAAQ,MAFZ;AAGI,IAAA,IAAI,EAAE6C,gBAHV;AAII,IAAA,MAAM,EAAEE,uBAJZ;AAKI,IAAA,QAAQ,EAAC,QALb;AAMI,IAAA,QAAQ,EAAE,KANd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAQI,oBAAC,KAAD,CAAO,MAAP;AAAc,IAAA,WAAW,MAAzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,KAAD,CAAO,KAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAc/C,SAAS,CAAC,mCAAD,CAAvB,CADJ,CARJ,eAWI,oBAAC,KAAD,CAAO,IAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,IAAD;AAAM,IAAA,EAAE,EAAC,YAAT;AAAsB,IAAA,SAAS,EAAEiD,SAAjC;AAA4C,IAAA,UAAU,MAAtD;AAAuD,IAAA,QAAQ,EAAE,kBAACyB,KAAD,EAAW;AACxEA,MAAAA,KAAK,CAACC,cAAN;AACAD,MAAAA,KAAK,CAACE,eAAN;AACA,UAAMC,QAAQ,GAAG,IAAIC,QAAJ,CAAaJ,KAAK,CAACK,MAAnB,CAAjB;AAAA,UAA6CC,WAAW,GAAGC,MAAM,CAACC,WAAP,CAAmBL,QAAQ,CAACM,OAAT,EAAnB,CAA3D;AAEA,UAAMC,IAAI,GAAGV,KAAK,CAACW,aAAnB;;AACA,UAAID,IAAI,CAACE,aAAL,OAAyB,IAA7B,EAAmC;AAC/BhD,QAAAA,gBAAgB,CAAC,IAAD,CAAhB;AACApC,QAAAA,eAAe,CAAC8E,WAAW,CAACjB,MAAb,CAAf,CAAoCX,IAApC,CAAyC,UAACC,GAAD,EAAS;AAE9C,cAAIA,GAAG,CAACC,IAAJ,CAASE,QAAT,CAAkB,OAAlB,CAAJ,EAAgC;AAC5BrB,YAAAA,QAAQ,CAACpB,iBAAiB,CAAC,OAAD,EAAUsC,GAAG,CAACC,IAAd,EAAoB,OAApB,CAAlB,CAAR;AACH,WAFD,MAEO;AACHhB,YAAAA,gBAAgB,CAAC,KAAD,CAAhB;AACAS,YAAAA,uBAAuB;AACvBP,YAAAA,UAAU,CAAC,CAACD,OAAF,CAAV;AACH;AAEJ,SAVD;AAWH;;AAEDW,MAAAA,YAAY,CAAC,IAAD,CAAZ;AAEH,KAvBD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAwBI,oBAAC,aAAD;AAAe,IAAA,SAAS,EAAC,gBAAzB;AAA0C,IAAA,KAAK,EAAEd,IAAI,CAACkC,aAAL,CAAmB;AAAET,MAAAA,EAAE,EAAE;AAAN,KAAnB,CAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,IAAD,CAAM,OAAN;AAAc,IAAA,QAAQ,MAAtB;AAAuB,IAAA,IAAI,EAAC,QAA5B;AAAqC,IAAA,WAAW,EAAC,KAAjD;AAAuD,IAAA,IAAI,EAAC,QAA5D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,CAxBJ,eA4BI;AAAI,IAAA,SAAS,EAAC,MAAd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA5BJ,eA8BI;AAAK,IAAA,SAAS,EAAC,gCAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBACI,oBAAC,MAAD;AAAQ,IAAA,KAAK,EAAE;AAAE0B,MAAAA,KAAK,EAAE;AAAT,KAAf;AAAiC,IAAA,OAAO,EAAC,mBAAzC;AAA6D,IAAA,OAAO,EAAExC,uBAAtE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACK/C,SAAS,CAAC,yBAAD,CADd,CADJ,eAII,oBAAC,MAAD;AAAQ,IAAA,IAAI,EAAC,QAAb;AAAsB,IAAA,KAAK,EAAE;AAAEuF,MAAAA,KAAK,EAAE;AAAT,KAA7B;AAA+C,IAAA,QAAQ,EAAElD,aAAa,GAAG,IAAH,GAAU,KAAhF;AAAuF,IAAA,SAAS,EAAC,UAAjG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KACKrC,SAAS,CAAC,+BAAD,CADd,EAEKqC,aAAa,iBAAI,oBAAC,OAAD;AAAS,IAAA,SAAS,EAAC,QAAnB;AAA4B,IAAA,IAAI,EAAC,IAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAFtB,CAJJ,CA9BJ,CADJ,CAXJ,CAPJ,EAgEQI,QAAQ,CAACb,MAAT,GAAkB,CAAlB,gBACI,oBAAC,cAAD;AACI,IAAA,QAAQ,EAAC,IADb;AAEI,IAAA,IAAI,EAAEa,QAFV;AAGI,IAAA,OAAO,EAAE0B,OAHb;AAII,IAAA,UAAU,EAAE7D,iBAAiB,EAJjC;AAKI,IAAA,UAAU,EAAE,kBALhB;AAMI,IAAA,aAAa,EAAE,qBANnB;AAOI,IAAA,MAAM,EAAEC,aAAa,EAPzB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IADJ,GASS,CAACoC,OAAD,gBAAW,oBAAC,GAAD;AAAK,IAAA,MAAM,EAAC,OAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAAoB,oBAAC,MAAD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAApB,CAAX,gBACD;AAAK,IAAA,SAAS,EAAC,0CAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAA2D3C,SAAS,CAAC,8BAAD,CAApE,CA1EhB,CADJ;AA+EH;AAAA","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport translate from \"../i18n/translate\";\r\nimport { getCustomerWithdrawRequests, requestWithdraw } from '../APIs/financialsAPIs';\r\nimport Loader from \"./Loader/Loader\";\r\nimport { Box } from \"@chakra-ui/layout\";\r\nimport BootstrapTable from 'react-bootstrap-table-next';\r\nimport paginationFactory from 'react-bootstrap-table2-paginator';\r\nimport filterFactory from 'react-bootstrap-table2-filter';\r\nimport { Button, Badge, Modal, Form, FloatingLabel, Spinner } from \"react-bootstrap\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { toastNotification } from \"../Actions/GeneralActions\";\r\nimport { useIntl } from \"react-intl\";\r\nimport { GiReceiveMoney } from 'react-icons/gi';\r\n\r\n/* display cancel button if the request is wating */\r\nfunction cancelFormatter(value) {\r\n    return <>\r\n        {value == 1 && <Button variant=\"danger\" style={{ fontSize: \"0.7rem\" }}>\r\n            {translate(\"WITHDRAW_REQUEST.CANCEL_REQUEST\")}\r\n        </Button>}\r\n    </>\r\n}\r\n\r\n/* format each request status */\r\nfunction statusFormatter(value) {\r\n    return <>\r\n        <Badge bg={value == \"WAITING\" ? \"warning\" : value == \"FINISHED\" ? \"success\" : \"danger\"}>\r\n            {translate(\"WITHDRAW_REQUEST.\" + value)}\r\n        </Badge>\r\n    </>\r\n}\r\n\r\n/* format each request amount */\r\nfunction amountFormatter(value) {\r\n    return <><span style={{ color: \"#26a69a\" }}>{value}</span> {\" NIS\"}</>;\r\n}\r\n\r\n/* time formatter, to convert from 24 hrs system to 12 hrs system */\r\nfunction timeFormatter(value) {\r\n    const tempStr = value.split(\":\");\r\n    let time = value;\r\n    if (tempStr[0].length === 1)\r\n        time = \"0\".concat(value);\r\n\r\n    // Check correct time format and split into components\r\n    time = time.toString().match(/^([01]\\d|2[0-3])(:)([0-5]\\d)(:[0-5]\\d)?$/) || [time];\r\n\r\n    if (time.length > 1) { // If time format correct\r\n        time = time.slice(1);  // Remove full string match value\r\n        time[5] = +time[0] < 12 ? ' AM' : ' PM'; // Set AM/PM\r\n        time[0] = +time[0] % 12 || 12; // Adjust hours\r\n    }\r\n    return time.join(''); // return adjusted time or original string\r\n}\r\n\r\nexport default function FinancialManagement() {\r\n\r\n    let dispatch = useDispatch();\r\n    const intl = useIntl();\r\n    const [loadinRequest, setLoadinRequest] = useState(false);\r\n    const [refresh, setRefresh] = useState(false);\r\n    const [requests, setRequests] = useState([]);\r\n    const [isEmpty, setIsEmpty] = useState(false);\r\n    const [showRequestModal, setShowRequestModal] = useState(false);\r\n    const handleCloseRequestModal = () => setShowRequestModal(false);\r\n    const handleShowRequestModal = () => setShowRequestModal(true);\r\n    const [validated, setValidated] = useState(false);\r\n\r\n    /* get all related withdrawal requests to be displayed in the table */\r\n    useEffect(() => {\r\n        let isMounted = true;\r\n        getCustomerWithdrawRequests().then((res) => {\r\n\r\n            if (!!!res.data.server_response) {\r\n                if (res.data.includes('error'))\r\n                    dispatch(toastNotification(\"Error\", res.data, \"error\"));\r\n            } else {\r\n                const tempArr = [];\r\n                const resArr = res.data.server_response;\r\n\r\n                for (let i = 0; i < resArr.length; i++) {\r\n                    tempArr.push({\r\n                        \"id\": resArr[i].id,\r\n                        \"date\": resArr[i].requestTime.split(\" \")[0],\r\n                        \"time\": resArr[i].requestTime.split(\" \")[1],\r\n                        \"amount\": resArr[i].amount,\r\n                        \"status\": resArr[i].isCanceled == 1 ? \"CANCELED\" : resArr[i].isRejected == 1 ? \"REJECTED\" : resArr[i].isApproved == 1 ? \"FINISHED\" : \"WAITING\",\r\n                        \"isActive\": (resArr[i].isCanceled == 1 || resArr[i].isRejected == 1 || resArr[i].isApproved == 1) ? 0 : 1\r\n                    });\r\n                }\r\n\r\n                if (isMounted) {\r\n                    setRequests(tempArr);\r\n\r\n\r\n                    if (tempArr.length > 0) {\r\n                        setIsEmpty(false)\r\n                    } else {\r\n                        setIsEmpty(true)\r\n                    }\r\n                }\r\n            }\r\n\r\n        })\r\n        return () => { isMounted = false };\r\n    }, [refresh]);\r\n\r\n    /* table columns */\r\n    const columns = [\r\n        {\r\n            dataField: 'date',\r\n            text: intl.formatMessage({ id: \"WITHDRAW_REQUEST.REQUEST_DATE\" })\r\n        },\r\n        {\r\n            dataField: 'time',\r\n            text: intl.formatMessage({ id: \"WITHDRAW_REQUEST.REQUEST_TIME\" }),\r\n            formatter: timeFormatter\r\n        },\r\n        {\r\n            dataField: 'amount',\r\n            text: intl.formatMessage({ id: \"WITHDRAW_REQUEST.WITHDRAWAL_AMOUNT\" }),\r\n            formatter: amountFormatter\r\n        },\r\n        {\r\n            dataField: 'status',\r\n            text: intl.formatMessage({ id: \"WITHDRAW_REQUEST.STATUS\" }),\r\n            formatter: statusFormatter\r\n        }/* ,\r\n        {\r\n            dataField: 'isActive',\r\n            text: \"\",\r\n            formatter: cancelFormatter\r\n        } */\r\n    ];\r\n\r\n    /* clear the borders for table headers */\r\n    for (let i = 0; i < columns.length; i++) {\r\n        columns[i].headerStyle = { border: 'none' }\r\n    }\r\n\r\n    return (\r\n        <div className=\"pe-4 ps-4 pt-2\">\r\n            <Button className='btn-grad mt-2 mb-3 d-flex justify-content-center' onClick={handleShowRequestModal}>\r\n                {translate(\"WITHDRAW_REQUEST.REQUEST_WITHDRAWAL\")}\r\n                <GiReceiveMoney className={\"ms-2 mt-1\"} />\r\n            </Button>\r\n\r\n            {/* to enter withdrawal amount */}\r\n            <Modal\r\n                className='togo-custom-modal-lg'\r\n                centered\r\n                show={showRequestModal}\r\n                onHide={handleCloseRequestModal}\r\n                backdrop=\"static\"\r\n                keyboard={false}\r\n            >\r\n                <Modal.Header closeButton>\r\n                    <Modal.Title>{translate(\"WITHDRAW_REQUEST.REQUEST_WITHDRAW\")}</Modal.Title>\r\n                </Modal.Header>\r\n                <Modal.Body>\r\n                    <Form id=\"amountForm\" validated={validated} noValidate onSubmit={(event) => {\r\n                        event.preventDefault();\r\n                        event.stopPropagation();\r\n                        const formData = new FormData(event.target), formDataObj = Object.fromEntries(formData.entries());\r\n\r\n                        const form = event.currentTarget;\r\n                        if (form.checkValidity() === true) {\r\n                            setLoadinRequest(true);\r\n                            requestWithdraw(formDataObj.amount).then((res) => {\r\n\r\n                                if (res.data.includes('error')) {\r\n                                    dispatch(toastNotification(\"Error\", res.data, \"error\"));\r\n                                } else {\r\n                                    setLoadinRequest(false);\r\n                                    handleCloseRequestModal();\r\n                                    setRefresh(!refresh);\r\n                                }\r\n\r\n                            })\r\n                        }\r\n\r\n                        setValidated(true);\r\n\r\n                    }}>\r\n                        <FloatingLabel controlId=\"floatingAmount\" label={intl.formatMessage({ id: \"WITHDRAW_REQUEST.AMOUNT\" })}>\r\n                            <Form.Control required type=\"number\" placeholder=\"...\" name=\"amount\" />\r\n                        </FloatingLabel>\r\n\r\n                        <hr className='my-3' />\r\n\r\n                        <div className='d-flex justify-content-between'>\r\n                            <Button style={{ width: \"45%\" }} variant=\"outline-secondary\" onClick={handleCloseRequestModal}>\r\n                                {translate(\"WITHDRAW_REQUEST.CANCEL\")}\r\n                            </Button>\r\n                            <Button type='submit' style={{ width: \"45%\" }} disabled={loadinRequest ? true : false} className='btn-grad'>\r\n                                {translate(\"WITHDRAW_REQUEST.SEND_REQUEST\")}\r\n                                {loadinRequest && <Spinner animation=\"border\" size=\"sm\" />}\r\n                            </Button>\r\n                        </div>\r\n                    </Form>\r\n                </Modal.Body>\r\n            </Modal>\r\n\r\n            {/* if there are not requests the 'no requests' message will be displayed, otherwise requests table will be shown */}\r\n            {\r\n                requests.length > 0 ?\r\n                    <BootstrapTable\r\n                        keyField='id'\r\n                        data={requests}\r\n                        columns={columns}\r\n                        pagination={paginationFactory()}\r\n                        rowClasses={\"custom-row-class\"}\r\n                        columnClasses={\"custom-column-class\"}\r\n                        filter={filterFactory()}\r\n                    /> : !isEmpty ? <Box height=\"400px\"><Loader /></Box> :\r\n                        <div className=\"w-100 d-flex justify-content-center mt-5\">{translate(\"WITHDRAW_REQUEST.NO_REQUESTS\")}</div>\r\n            }\r\n        </div>\r\n    )\r\n};\r\n"]},"metadata":{},"sourceType":"module"}