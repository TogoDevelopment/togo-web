{"ast":null,"code":"import _regeneratorRuntime from \"/home/system/togo-web-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/system/togo-web-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { apiUrl } from \"../Constants/GeneralCont\";\nimport { getUserToken } from \"../firebase\";\nimport { updateWebNotificationToken } from \"./ProfileAPIs\";\nvar axios = require(\"axios\");\nvar requestHeaders = {\n  \"Access-Control-Allow-Origin\": \"*\",\n  \"Content-Type\": \"application/x-www-form-urlencoded\"\n};\nexport var PAGE_SIZE = 10;\nexport function getUserCreditialParams() {\n  var requestParams = new URLSearchParams();\n  requestParams.append(\"TransporterId\", localStorage.getItem(\"userId\"));\n  requestParams.append(\"TokenDevice\", localStorage.getItem(\"TokenDevice\"));\n  //TODO::change to language id\n  requestParams.append(\"LangId\", (localStorage.getItem(\"Language\") || \"en\") === \"en\" ? \"1\" : \"2\");\n  // requestParams.append(\"Idlanguage\", \"1\"); // test\n  // requestParams.append(\"PageSize\", PAGE_SIZE);\n  // requestParams.append(\"PageNumber\", \"1\");\n  requestParams.append(\"CustomerId\", localStorage.getItem(\"userId\"));\n  requestParams.append(\"ClientId\", localStorage.getItem(\"userId\"));\n  // requestParams.append(\n  //     \"TokenDevice\",\n  //     \"43507034b1ad5612d9d540278cc4c6e033950727\"\n  // );\n  return requestParams;\n}\nexport function getAuthenticationQR() {\n  var params = getUserCreditialParams();\n  params.append(\"CheckTypeFunction\", \"GenerateUUID\");\n  return axios.post(apiUrl, params, {\n    headers: requestHeaders\n  }).then(function (response) {\n    if (response.data === \"Function Not Found\") {\n      return \"null\";\n    }\n    return response.data;\n  }).catch(function (error) {\n    console.log(error);\n  });\n}\nfunction requestPermission() {\n  console.log('Requesting permission...');\n  Notification.requestPermission().then(function (permission) {\n    if (permission === 'granted') {\n      console.log('Notification permission granted.');\n      tokenFunc();\n    } else {\n      console.log('Notification permission denied.');\n    }\n  });\n}\nvar data;\nfunction tokenFunc() {\n  return _tokenFunc.apply(this, arguments);\n}\nfunction _tokenFunc() {\n  _tokenFunc = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return getUserToken();\n          case 2:\n            data = _context.sent;\n            if (data) {\n              console.log(\"Token is\", data);\n              updateWebNotificationToken(data).then(function (res) {\n                console.log(res.data);\n              });\n            }\n            return _context.abrupt(\"return\", data);\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _tokenFunc.apply(this, arguments);\n}\nexport var checkAccessAPI = function checkAccessAPI(qrUUID) {\n  var params = new URLSearchParams();\n  params.append(\"CheckTypeFunction\", \"getUserCredentials\");\n  params.append(\"QRId\", qrUUID);\n  return axios.post(apiUrl, params, {\n    headers: requestHeaders\n  }).then(function (response) {\n    if (response.data === \"Function Not Found\" || response.data.ResultArray[0].CustomerId === null) {\n      return false;\n    }\n    localStorage.setItem(\"fullName\", response.data.ResultArray[0].FullName);\n    localStorage.setItem(\"userId\", response.data.ResultArray[0].CustomerId);\n    localStorage.setItem(\"TokenDevice\", response.data.ResultArray[0].TokenDevice);\n    localStorage.setItem(\"UserType\", response.data.ResultArray[0].UserType);\n    localStorage.setItem(\"IsTransporterMaster\", response.data.ResultArray[0].IsTransporterMaster);\n    localStorage.setItem(\"IsTeamMember\", response.data.ResultArray[0].IsTeamMember);\n    if (response.data.ResultArray[0].isFoodClient == \"1\") {\n      localStorage.setItem(\"IsFoodClient\", \"true\");\n    } else {\n      localStorage.setItem(\"IsFoodClient\", \"false\");\n    }\n    requestPermission();\n    return true;\n  }).catch(function (error) {\n    console.log(error);\n  });\n};","map":{"version":3,"names":["apiUrl","getUserToken","updateWebNotificationToken","axios","require","requestHeaders","PAGE_SIZE","getUserCreditialParams","requestParams","URLSearchParams","append","localStorage","getItem","getAuthenticationQR","params","post","headers","then","response","data","catch","error","console","log","requestPermission","Notification","permission","tokenFunc","_tokenFunc","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","wrap","_callee$","_context","prev","next","sent","res","abrupt","stop","checkAccessAPI","qrUUID","ResultArray","CustomerId","setItem","FullName","TokenDevice","UserType","IsTransporterMaster","IsTeamMember","isFoodClient"],"sources":["/home/system/togo-web-test/src/APIs/AuthenticationAPIs.jsx"],"sourcesContent":["import { apiUrl } from \"../Constants/GeneralCont\";\r\n\r\nimport { getUserToken } from \"../firebase\";\r\nimport { updateWebNotificationToken } from \"./ProfileAPIs\";\r\n\r\nconst axios = require(\"axios\");\r\nconst requestHeaders = {\r\n    \"Access-Control-Allow-Origin\": `*`,\r\n    \"Content-Type\": `application/x-www-form-urlencoded`,\r\n};\r\n\r\nexport const PAGE_SIZE = 10;\r\n\r\nexport function getUserCreditialParams() {\r\n    var requestParams = new URLSearchParams();\r\n\r\n    requestParams.append(\"TransporterId\", localStorage.getItem(\"userId\"));\r\n    requestParams.append(\"TokenDevice\", localStorage.getItem(\"TokenDevice\"));\r\n    //TODO::change to language id\r\n    requestParams.append(\"LangId\", (localStorage.getItem(\"Language\") || \"en\") === \"en\" ? \"1\" : \"2\");\r\n    // requestParams.append(\"Idlanguage\", \"1\"); // test\r\n    // requestParams.append(\"PageSize\", PAGE_SIZE);\r\n    // requestParams.append(\"PageNumber\", \"1\");\r\n    requestParams.append(\"CustomerId\", localStorage.getItem(\"userId\"));\r\n    requestParams.append(\"ClientId\", localStorage.getItem(\"userId\"));\r\n    // requestParams.append(\r\n    //     \"TokenDevice\",\r\n    //     \"43507034b1ad5612d9d540278cc4c6e033950727\"\r\n    // );\r\n    return requestParams;\r\n}\r\n\r\nexport function getAuthenticationQR() {\r\n    let params = getUserCreditialParams();\r\n    params.append(\"CheckTypeFunction\", \"GenerateUUID\");\r\n    return axios\r\n        .post(apiUrl, params, {\r\n            headers: requestHeaders,\r\n        })\r\n        .then((response) => {\r\n            if (response.data === \"Function Not Found\") {\r\n                return \"null\";\r\n            }\r\n            return response.data;\r\n        })\r\n        .catch((error) => {\r\n            console.log(error);\r\n        });\r\n}\r\n\r\nfunction requestPermission() {\r\n    console.log('Requesting permission...');\r\n    Notification.requestPermission().then((permission) => {\r\n        if (permission === 'granted') {\r\n            console.log('Notification permission granted.');\r\n\r\n            tokenFunc();\r\n        } else {\r\n            console.log('Notification permission denied.');\r\n        }\r\n    })\r\n}\r\n\r\nlet data;\r\n\r\nasync function tokenFunc() {\r\n    data = await getUserToken();\r\n    if (data) {\r\n        console.log(\"Token is\", data);\r\n\r\n        updateWebNotificationToken(data).then((res) => {\r\n            console.log(res.data);\r\n        })\r\n    }\r\n    return data;\r\n}\r\n\r\nexport const checkAccessAPI = (qrUUID) => {\r\n    let params = new URLSearchParams();\r\n    params.append(\"CheckTypeFunction\", \"getUserCredentials\");\r\n    params.append(\"QRId\", qrUUID);\r\n    return axios\r\n        .post(apiUrl, params, {\r\n            headers: requestHeaders,\r\n        })\r\n        .then((response) => {\r\n            if (\r\n                response.data === \"Function Not Found\" ||\r\n                response.data.ResultArray[0].CustomerId === null\r\n            ) {\r\n                return false;\r\n            }\r\n\r\n            localStorage.setItem(\"fullName\", response.data.ResultArray[0].FullName);\r\n            localStorage.setItem(\"userId\", response.data.ResultArray[0].CustomerId);\r\n            localStorage.setItem(\"TokenDevice\", response.data.ResultArray[0].TokenDevice);\r\n            localStorage.setItem(\"UserType\", response.data.ResultArray[0].UserType);\r\n            localStorage.setItem(\"IsTransporterMaster\", response.data.ResultArray[0].IsTransporterMaster);\r\n            localStorage.setItem(\"IsTeamMember\", response.data.ResultArray[0].IsTeamMember);\r\n\r\n            if (response.data.ResultArray[0].isFoodClient == \"1\") {\r\n                localStorage.setItem(\"IsFoodClient\", \"true\");\r\n            } else {\r\n                localStorage.setItem(\"IsFoodClient\", \"false\");\r\n            }\r\n\r\n            requestPermission();\r\n\r\n            return true;\r\n        })\r\n        .catch((error) => {\r\n            console.log(error);\r\n        });\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}