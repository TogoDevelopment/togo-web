{"ast":null,"code":"import _regeneratorRuntime from \"/home/system/togo-web-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/system/togo-web-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"/home/system/togo-web-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/system/togo-web-test/src/components/loginByPhoneNumber/LoginByPhoneNumber.jsx\";\nimport React, { useRef, useState } from \"react\";\nimport Card from 'react-bootstrap/Card';\nimport Button from 'react-bootstrap/Button';\nimport Form from 'react-bootstrap/Form';\nimport Modal from 'react-bootstrap/Modal';\nimport Spinner from 'react-bootstrap/Spinner';\nimport { sendVerificationCode, loginWithNumber } from \"../../APIs/LoginAPIs\";\nimport { updateWebNotificationToken } from \"../../APIs/ProfileAPIs\";\nimport { useDispatch } from \"react-redux\";\nimport { toastNotification } from \"../../Actions/GeneralActions\";\nimport { useHistory } from \"react-router\";\nimport { getUserToken } from \"../../firebase\";\nexport default function LoginByPhoneNumber() {\n  var styles = {\n    cardHeaderLg: {\n      position: 'absolute',\n      left: '20px',\n      right: '20px',\n      top: '-20px',\n      background: \"linear-gradient(90deg, #26a69a, #69d4a5)\",\n      color: 'white',\n      borderRadius: '10px',\n      fontWeight: 'bold',\n      fontSize: \"1.5rem\"\n    },\n    cardHeaderSm: {\n      position: 'absolute',\n      left: '20px',\n      top: '-20px',\n      background: \"linear-gradient(90deg, #26a69a, #69d4a5)\",\n      color: 'white',\n      borderRadius: '10px',\n      fontWeight: 'bold',\n      fontSize: \"1.2rem\"\n    }\n  };\n  var dispatch = useDispatch();\n  var history = useHistory();\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      show = _useState2[0],\n      setShow = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      shadowErrorForMobile = _useState4[0],\n      setShowErrorForMobile = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      shadowErrorForCode = _useState6[0],\n      setShowErrorForCode = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      startValidationForMobile = _useState8[0],\n      setStartValidationForMobile = _useState8[1];\n\n  var _useState9 = useState(false),\n      _useState10 = _slicedToArray(_useState9, 2),\n      startValidationForCode = _useState10[0],\n      setStartValidationForCode = _useState10[1];\n\n  var _useState11 = useState(false),\n      _useState12 = _slicedToArray(_useState11, 2),\n      loadingSend = _useState12[0],\n      setLoadingSend = _useState12[1];\n\n  var _useState13 = useState(false),\n      _useState14 = _slicedToArray(_useState13, 2),\n      loadingLogin = _useState14[0],\n      setLloadingLogin = _useState14[1];\n\n  var _useState15 = useState(\"\"),\n      _useState16 = _slicedToArray(_useState15, 2),\n      customerId = _useState16[0],\n      setCustomerId = _useState16[1];\n\n  var handleClose = function handleClose() {\n    return setShow(false);\n  };\n\n  var handleShow = function handleShow() {\n    return setShow(true);\n  };\n\n  var numberRef = useRef();\n  var codeRef = useRef();\n\n  function sendCode() {\n    setStartValidationForMobile(true);\n\n    if (isValidNumber(numberRef.current.value)) {\n      setShowErrorForMobile(false);\n      setLoadingSend(true);\n      sendVerificationCode(numberRef.current.value).then(function (res) {\n        // console.log(res.data);\n        if (res.data === \"MobileNotFound\") {\n          dispatch(toastNotification(\"Error\", \"Mobile not found!\", \"error\"));\n          setLoadingSend(false);\n        } else if (res.data === \"NotUpdated\") {\n          dispatch(toastNotification(\"Error\", \"Something went wrong!\", \"error\"));\n          setLoadingSend(false);\n        } else {\n          // console.log(res.data.split(\"-\")[1]);\n          setCustomerId(res.data.split(\"-\")[1]);\n          setLoadingSend(false);\n          handleShow();\n        }\n      });\n    } else {\n      setShowErrorForMobile(true);\n    }\n  }\n\n  function isValidNumber(inputtxt) {\n    var phoneno = /^\\d{10}$/;\n\n    if (inputtxt.match(phoneno)) {\n      return true;\n    } else {\n      return false;\n    }\n  }\n\n  function requestPermission() {\n    console.log('Requesting permission...');\n    Notification.requestPermission().then(function (permission) {\n      if (permission === 'granted') {\n        console.log('Notification permission granted.');\n        tokenFunc();\n      } else {\n        console.log('Notification permission denied.');\n      }\n    });\n  }\n\n  var data;\n\n  function tokenFunc() {\n    return _tokenFunc.apply(this, arguments);\n  }\n\n  function _tokenFunc() {\n    _tokenFunc = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return getUserToken();\n\n            case 2:\n              data = _context.sent;\n\n              if (data) {\n                console.log(\"Token is\", data);\n                updateWebNotificationToken(data).then(function (res) {\n                  console.log(res.data);\n                });\n              }\n\n              return _context.abrupt(\"return\", data);\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n    return _tokenFunc.apply(this, arguments);\n  }\n\n  function handleLogin() {\n    setStartValidationForCode(true);\n\n    if (codeRef.current.value.length !== 4) {\n      setShowErrorForCode(true);\n    } else {\n      setShowErrorForCode(false);\n      setLloadingLogin(true);\n      loginWithNumber(customerId, codeRef.current.value).then(function (res) {\n        // console.log(res.data);\n        if (res.data.indexOf(\"!\") != 0) {\n          dispatch(toastNotification(\"Error\", res.data, \"error\"));\n          setLloadingLogin(false);\n        } else {\n          console.log(res.data);\n          localStorage.setItem(\"fullName\", res.data.fullName);\n          localStorage.setItem(\"userId\", res.data.userId);\n          localStorage.setItem(\"TokenDevice\", res.tokenDevice);\n          localStorage.setItem(\"UserType\", res.data.userType); // request notification permission and get FCM token\n\n          requestPermission();\n          setLloadingLogin(false); // history.push(\"/account/main/\");\n        }\n      });\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container-fluid mt-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"row d-flex justify-content-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-6\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Card, {\n    className: \"shadow h-100 rounded-22\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Card.Header, {\n    style: styles.cardHeaderLg,\n    className: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 29\n    }\n  }, \"Sign in By Phone Number\"), /*#__PURE__*/React.createElement(Card.Body, {\n    className: \"mt-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Form, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(Form.Group, {\n    className: \"mb-3\",\n    controlId: \"formBasicEmail\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 170,\n      columnNumber: 41\n    }\n  }, \"Please enter your phone number (start with 0)\"), /*#__PURE__*/React.createElement(Form.Control, {\n    type: \"number\",\n    placeholder: \"Phone number...\",\n    ref: numberRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 171,\n      columnNumber: 41\n    }\n  }), shadowErrorForMobile && startValidationForMobile && /*#__PURE__*/React.createElement(Form.Text, {\n    className: \"text-danger\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 94\n    }\n  }, \"Please enter a valid phone number!\")), /*#__PURE__*/React.createElement(Button, {\n    className: \"btn-grad\",\n    onClick: sendCode,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 37\n    }\n  }, loadingSend && /*#__PURE__*/React.createElement(Spinner, {\n    animation: \"border\",\n    size: \"sm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 57\n    }\n  }), \"Send\"))))))), /*#__PURE__*/React.createElement(Modal, {\n    show: show,\n    onHide: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Modal.Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 17\n    }\n  }, \"Sign In\"), /*#__PURE__*/React.createElement(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 193,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Form, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Form.Group, {\n    className: \"mb-3\",\n    controlId: \"formBasicEmail\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Form.Label, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 29\n    }\n  }, \"Enter the code\"), /*#__PURE__*/React.createElement(Form.Control, {\n    type: \"number\",\n    placeholder: \"####\",\n    ref: codeRef,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 29\n    }\n  }), shadowErrorForCode && startValidationForCode && /*#__PURE__*/React.createElement(Form.Text, {\n    className: \"text-danger\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 78\n    }\n  }, \"Enter four-digit Code!\")), /*#__PURE__*/React.createElement(Button, {\n    className: \"btn-grad\",\n    onClick: handleLogin,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 25\n    }\n  }, loadingLogin && /*#__PURE__*/React.createElement(Spinner, {\n    animation: \"border\",\n    size: \"sm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 46\n    }\n  }), \"Login\")))));\n}","map":{"version":3,"sources":["/home/system/togo-web-test/src/components/loginByPhoneNumber/LoginByPhoneNumber.jsx"],"names":["React","useRef","useState","Card","Button","Form","Modal","Spinner","sendVerificationCode","loginWithNumber","updateWebNotificationToken","useDispatch","toastNotification","useHistory","getUserToken","LoginByPhoneNumber","styles","cardHeaderLg","position","left","right","top","background","color","borderRadius","fontWeight","fontSize","cardHeaderSm","dispatch","history","show","setShow","shadowErrorForMobile","setShowErrorForMobile","shadowErrorForCode","setShowErrorForCode","startValidationForMobile","setStartValidationForMobile","startValidationForCode","setStartValidationForCode","loadingSend","setLoadingSend","loadingLogin","setLloadingLogin","customerId","setCustomerId","handleClose","handleShow","numberRef","codeRef","sendCode","isValidNumber","current","value","then","res","data","split","inputtxt","phoneno","match","requestPermission","console","log","Notification","permission","tokenFunc","handleLogin","length","indexOf","localStorage","setItem","fullName","userId","tokenDevice","userType"],"mappings":"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","sourcesContent":["import React, { useRef, useState } from \"react\";\r\nimport Card from 'react-bootstrap/Card';\r\nimport Button from 'react-bootstrap/Button';\r\nimport Form from 'react-bootstrap/Form';\r\nimport Modal from 'react-bootstrap/Modal';\r\nimport Spinner from 'react-bootstrap/Spinner';\r\nimport { sendVerificationCode, loginWithNumber } from \"../../APIs/LoginAPIs\";\r\nimport { updateWebNotificationToken } from \"../../APIs/ProfileAPIs\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { toastNotification } from \"../../Actions/GeneralActions\";\r\nimport { useHistory } from \"react-router\";\r\nimport { getUserToken } from \"../../firebase\";\r\n\r\nexport default function LoginByPhoneNumber() {\r\n    const styles = {\r\n        cardHeaderLg: {\r\n            position: 'absolute',\r\n            left: '20px',\r\n            right: '20px',\r\n            top: '-20px',\r\n            background: \"linear-gradient(90deg, #26a69a, #69d4a5)\",\r\n            color: 'white',\r\n            borderRadius: '10px',\r\n            fontWeight: 'bold',\r\n            fontSize: \"1.5rem\"\r\n        },\r\n        cardHeaderSm: {\r\n            position: 'absolute',\r\n            left: '20px',\r\n            top: '-20px',\r\n            background: \"linear-gradient(90deg, #26a69a, #69d4a5)\",\r\n            color: 'white',\r\n            borderRadius: '10px',\r\n            fontWeight: 'bold',\r\n            fontSize: \"1.2rem\"\r\n        },\r\n    }\r\n\r\n    let dispatch = useDispatch();\r\n    const history = useHistory();\r\n\r\n    const [show, setShow] = useState(false);\r\n    const [shadowErrorForMobile, setShowErrorForMobile] = useState(false);\r\n    const [shadowErrorForCode, setShowErrorForCode] = useState(false);\r\n    const [startValidationForMobile, setStartValidationForMobile] = useState(false);\r\n    const [startValidationForCode, setStartValidationForCode] = useState(false);\r\n    const [loadingSend, setLoadingSend] = useState(false);\r\n    const [loadingLogin, setLloadingLogin] = useState(false);\r\n    const [customerId, setCustomerId] = useState(\"\");\r\n\r\n    const handleClose = () => setShow(false);\r\n    const handleShow = () => setShow(true);\r\n\r\n    const numberRef = useRef();\r\n    const codeRef = useRef();\r\n\r\n    function sendCode() {\r\n        setStartValidationForMobile(true);\r\n        if (isValidNumber(numberRef.current.value)) {\r\n            setShowErrorForMobile(false);\r\n            setLoadingSend(true);\r\n\r\n            sendVerificationCode(numberRef.current.value).then((res) => {\r\n\r\n                // console.log(res.data);\r\n\r\n                if (res.data === \"MobileNotFound\") {\r\n                    dispatch(toastNotification(\"Error\", \"Mobile not found!\", \"error\"));\r\n                    setLoadingSend(false);\r\n                } else if (res.data === \"NotUpdated\") {\r\n                    dispatch(toastNotification(\"Error\", \"Something went wrong!\", \"error\"));\r\n                    setLoadingSend(false);\r\n                } else {\r\n                    // console.log(res.data.split(\"-\")[1]);\r\n                    setCustomerId(res.data.split(\"-\")[1]);\r\n                    setLoadingSend(false);\r\n                    handleShow();\r\n                }\r\n            })\r\n\r\n        } else {\r\n            setShowErrorForMobile(true);\r\n        }\r\n    }\r\n\r\n    function isValidNumber(inputtxt) {\r\n        let phoneno = /^\\d{10}$/;\r\n        if (inputtxt.match(phoneno)) {\r\n            return true;\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    function requestPermission() {\r\n        console.log('Requesting permission...');\r\n        Notification.requestPermission().then((permission) => {\r\n            if (permission === 'granted') {\r\n                console.log('Notification permission granted.');\r\n\r\n                tokenFunc();\r\n            } else {\r\n                console.log('Notification permission denied.');\r\n            }\r\n        })\r\n    }\r\n\r\n    let data;\r\n\r\n    async function tokenFunc() {\r\n        data = await getUserToken();\r\n        if (data) {\r\n            console.log(\"Token is\", data);\r\n\r\n            updateWebNotificationToken(data).then((res) => {\r\n                console.log(res.data);\r\n            })\r\n        }\r\n        return data;\r\n    }\r\n\r\n    function handleLogin() {\r\n        setStartValidationForCode(true);\r\n        if (codeRef.current.value.length !== 4) {\r\n            setShowErrorForCode(true);\r\n\r\n        } else {\r\n            setShowErrorForCode(false);\r\n            setLloadingLogin(true);\r\n\r\n            loginWithNumber(customerId, codeRef.current.value).then((res) => {\r\n                // console.log(res.data);\r\n                if (res.data.indexOf(\"!\") != 0) {\r\n                    dispatch(toastNotification(\"Error\", res.data, \"error\"));\r\n                    setLloadingLogin(false);\r\n                }  else {\r\n\r\n                    console.log(res.data);\r\n\r\n                    localStorage.setItem(\"fullName\", res.data.fullName);\r\n                    localStorage.setItem(\"userId\", res.data.userId);\r\n                    localStorage.setItem(\"TokenDevice\", res.tokenDevice);\r\n                    localStorage.setItem(\"UserType\", res.data.userType);\r\n\r\n                    // request notification permission and get FCM token\r\n                    requestPermission();\r\n\r\n                    setLloadingLogin(false);\r\n\r\n                    // history.push(\"/account/main/\");\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <div className=\"container-fluid mt-5\">\r\n                <div className=\"row d-flex justify-content-center\">\r\n                    <div className=\"col-6\">\r\n                        <Card className='shadow h-100 rounded-22'>\r\n                            <Card.Header style={styles.cardHeaderLg} className=\"\">\r\n                                Sign in By Phone Number\r\n                            </Card.Header>\r\n\r\n                            <Card.Body className=\"mt-5\">\r\n                                <Form>\r\n                                    <Form.Group className=\"mb-3\" controlId=\"formBasicEmail\">\r\n                                        <Form.Label>Please enter your phone number (start with 0)</Form.Label>\r\n                                        <Form.Control type=\"number\" placeholder=\"Phone number...\" ref={numberRef} />\r\n                                        {shadowErrorForMobile && startValidationForMobile && <Form.Text className=\"text-danger\">\r\n                                            Please enter a valid phone number!\r\n                                        </Form.Text>}\r\n                                    </Form.Group>\r\n\r\n                                    <Button className=\"btn-grad\" onClick={sendCode}>\r\n                                        {loadingSend && <Spinner animation=\"border\" size=\"sm\" />}\r\n                                        Send\r\n                                    </Button>\r\n                                </Form>\r\n                            </Card.Body>\r\n                        </Card>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <Modal show={show} onHide={handleClose}>\r\n                <Modal.Header>\r\n                    Sign In\r\n                </Modal.Header>\r\n\r\n                <Modal.Body>\r\n                    <Form>\r\n                        <Form.Group className=\"mb-3\" controlId=\"formBasicEmail\">\r\n                            <Form.Label>Enter the code</Form.Label>\r\n                            <Form.Control type=\"number\" placeholder=\"####\" ref={codeRef} />\r\n                            {shadowErrorForCode && startValidationForCode && <Form.Text className=\"text-danger\">\r\n                                Enter four-digit Code!\r\n                            </Form.Text>}\r\n                        </Form.Group>\r\n\r\n                        <Button className=\"btn-grad\" onClick={handleLogin}>\r\n                            {loadingLogin && <Spinner animation=\"border\" size=\"sm\" />}\r\n                            Login\r\n                        </Button>\r\n                    </Form>\r\n                </Modal.Body>\r\n            </Modal>\r\n        </>\r\n    )\r\n}"]},"metadata":{},"sourceType":"module"}