{"ast":null,"code":"import _regeneratorRuntime from \"/home/system/togo-web-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/system/togo-web-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { apiUrl } from \"../Constants/GeneralCont\";\nimport { io } from \"socket.io-client\";\nimport { getUserToken } from \"../firebase\";\nimport { updateWebNotificationToken } from \"./ProfileAPIs\";\n\nvar axios = require(\"axios\");\n\nvar requestHeaders = {\n  \"Access-Control-Allow-Origin\": \"*\",\n  \"Content-Type\": \"application/x-www-form-urlencoded\"\n};\nexport var PAGE_SIZE = 10;\nexport function getUserCreditialParams() {\n  var requestParams = new URLSearchParams();\n  requestParams.append(\"TransporterId\", localStorage.getItem(\"userId\"));\n  requestParams.append(\"TokenDevice\", localStorage.getItem(\"TokenDevice\")); //TODO::change to language id\n\n  requestParams.append(\"LangId\", \"1\");\n  requestParams.append(\"Idlanguage\", \"1\"); //requestParams.append(\"PageSize\", PAGE_SIZE);\n  //requestParams.append(\"PageNumber\", \"1\");\n\n  requestParams.append(\"CustomerId\", localStorage.getItem(\"userId\"));\n  requestParams.append(\"ClientId\", localStorage.getItem(\"userId\")); // requestParams.append(\n  //     \"TokenDevice\",\n  //     \"43507034b1ad5612d9d540278cc4c6e033950727\"\n  // );\n\n  return requestParams;\n}\nexport function getAuthenticationQR() {\n  var params = getUserCreditialParams();\n  params.append(\"CheckTypeFunction\", \"GenerateUUID\");\n  return axios.post(apiUrl, params, {\n    headers: requestHeaders\n  }).then(function (response) {\n    if (response.data === \"Function Not Found\") {\n      return \"null\";\n    }\n\n    return response.data;\n  }).catch(function (error) {\n    console.log(error);\n  });\n}\n\nfunction requestPermission() {\n  console.log('Requesting permission...');\n  Notification.requestPermission().then(function (permission) {\n    if (permission === 'granted') {\n      console.log('Notification permission granted.');\n      tokenFunc();\n    } else {\n      console.log('Notification permission denied.');\n    }\n  });\n}\n\nvar data;\n\nfunction tokenFunc() {\n  return _tokenFunc.apply(this, arguments);\n}\n\nfunction _tokenFunc() {\n  _tokenFunc = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return getUserToken();\n\n          case 2:\n            data = _context.sent;\n\n            if (data) {\n              alert(\"Token is\", data);\n              updateWebNotificationToken(data).then(function (res) {\n                console.log(res.data);\n              });\n            }\n\n            return _context.abrupt(\"return\", data);\n\n          case 5:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return _tokenFunc.apply(this, arguments);\n}\n\nexport var checkAccessAPI = function checkAccessAPI(qrUUID) {\n  var params = new URLSearchParams();\n  params.append(\"CheckTypeFunction\", \"getUserCredentials\");\n  params.append(\"QRId\", qrUUID);\n  return axios.post(apiUrl, params, {\n    headers: requestHeaders\n  }).then(function (response) {\n    if (response.data === \"Function Not Found\" || response.data.ResultArray[0].CustomerId === null) {\n      return false;\n    }\n    /* const socket = io(\"http://46.253.93.4:5000\");\r\n    socket.emit(\"login\", response.data.ResultArray[0].CustomerId, response.data.ResultArray[0].UserType); */\n\n    /* console.log(\"-----------\")\r\n    console.log(socket) */\n    // console.log(\"loggen in\"); // temp test\n    // alert(\"test ------\")\n\n\n    localStorage.setItem(\"fullName\", response.data.ResultArray[0].FullName); // edited (fullName added)\n\n    localStorage.setItem(\"userId\", response.data.ResultArray[0].CustomerId);\n    localStorage.setItem(\"TokenDevice\", response.data.ResultArray[0].TokenDevice);\n    localStorage.setItem(\"UserType\", response.data.ResultArray[0].UserType);\n    localStorage.setItem(\"IsTransporterMaster\", response.data.ResultArray[0].IsTransporterMaster);\n    localStorage.setItem(\"IsTeamMember\", response.data.ResultArray[0].IsTeamMember);\n    /* const socket = io(\"http://46.253.93.4:5000\");\r\n    socket.emit(\"addUpdateUser\", localStorage.getItem(\"userId\"), localStorage.getItem(\"UserType\")); */\n    ////////////////////////////\n\n    requestPermission(); ////////////////////////////\n\n    return true;\n  }).catch(function (error) {\n    console.log(error);\n  });\n};","map":{"version":3,"sources":["/home/system/togo-web-test/src/APIs/AuthenticationAPIs.jsx"],"names":["apiUrl","io","getUserToken","updateWebNotificationToken","axios","require","requestHeaders","PAGE_SIZE","getUserCreditialParams","requestParams","URLSearchParams","append","localStorage","getItem","getAuthenticationQR","params","post","headers","then","response","data","catch","error","console","log","requestPermission","Notification","permission","tokenFunc","alert","res","checkAccessAPI","qrUUID","ResultArray","CustomerId","setItem","FullName","TokenDevice","UserType","IsTransporterMaster","IsTeamMember"],"mappings":"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","sourcesContent":["import { apiUrl } from \"../Constants/GeneralCont\";\r\nimport { io } from \"socket.io-client\";\r\n\r\nimport { getUserToken } from \"../firebase\";\r\nimport { updateWebNotificationToken } from \"./ProfileAPIs\";\r\n\r\nconst axios = require(\"axios\");\r\nconst requestHeaders = {\r\n    \"Access-Control-Allow-Origin\": `*`,\r\n    \"Content-Type\": `application/x-www-form-urlencoded`,\r\n};\r\n\r\nexport const PAGE_SIZE = 10;\r\n\r\nexport function getUserCreditialParams() {\r\n    var requestParams = new URLSearchParams();\r\n\r\n    requestParams.append(\"TransporterId\", localStorage.getItem(\"userId\"));\r\n    requestParams.append(\"TokenDevice\", localStorage.getItem(\"TokenDevice\"));\r\n    //TODO::change to language id\r\n    requestParams.append(\"LangId\", \"1\");\r\n    requestParams.append(\"Idlanguage\", \"1\");\r\n    //requestParams.append(\"PageSize\", PAGE_SIZE);\r\n    //requestParams.append(\"PageNumber\", \"1\");\r\n    requestParams.append(\"CustomerId\", localStorage.getItem(\"userId\"));\r\n    requestParams.append(\"ClientId\", localStorage.getItem(\"userId\"));\r\n    // requestParams.append(\r\n    //     \"TokenDevice\",\r\n    //     \"43507034b1ad5612d9d540278cc4c6e033950727\"\r\n    // );\r\n    return requestParams;\r\n}\r\n\r\nexport function getAuthenticationQR() {\r\n    let params = getUserCreditialParams();\r\n    params.append(\"CheckTypeFunction\", \"GenerateUUID\");\r\n    return axios\r\n        .post(apiUrl, params, {\r\n            headers: requestHeaders,\r\n        })\r\n        .then((response) => {\r\n            if (response.data === \"Function Not Found\") {\r\n                return \"null\";\r\n            }\r\n            return response.data;\r\n        })\r\n        .catch((error) => {\r\n            console.log(error);\r\n        });\r\n}\r\n\r\nfunction requestPermission() {\r\n    console.log('Requesting permission...');\r\n    Notification.requestPermission().then((permission) => {\r\n        if (permission === 'granted') {\r\n            console.log('Notification permission granted.');\r\n\r\n            tokenFunc();\r\n        } else {\r\n            console.log('Notification permission denied.');\r\n        }\r\n    })\r\n}\r\n\r\nlet data;\r\n\r\nasync function tokenFunc() {\r\n    data = await getUserToken();\r\n    if (data) {\r\n        alert(\"Token is\", data);\r\n\r\n        updateWebNotificationToken(data).then((res) => {\r\n            console.log(res.data);\r\n        })\r\n    }\r\n    return data;\r\n}\r\n\r\nexport const checkAccessAPI = (qrUUID) => {\r\n    let params = new URLSearchParams();\r\n    params.append(\"CheckTypeFunction\", \"getUserCredentials\");\r\n    params.append(\"QRId\", qrUUID);\r\n    return axios\r\n        .post(apiUrl, params, {\r\n            headers: requestHeaders,\r\n        })\r\n        .then((response) => {\r\n            if (\r\n                response.data === \"Function Not Found\" ||\r\n                response.data.ResultArray[0].CustomerId === null\r\n            ) {\r\n                return false;\r\n            }\r\n\r\n            /* const socket = io(\"http://46.253.93.4:5000\");\r\n            socket.emit(\"login\", response.data.ResultArray[0].CustomerId, response.data.ResultArray[0].UserType); */\r\n\r\n            /* console.log(\"-----------\")\r\n            console.log(socket) */\r\n\r\n            // console.log(\"loggen in\"); // temp test\r\n\r\n            // alert(\"test ------\")\r\n\r\n            localStorage.setItem(\"fullName\", response.data.ResultArray[0].FullName); // edited (fullName added)\r\n            localStorage.setItem(\"userId\", response.data.ResultArray[0].CustomerId);\r\n            localStorage.setItem(\"TokenDevice\", response.data.ResultArray[0].TokenDevice);\r\n            localStorage.setItem(\"UserType\", response.data.ResultArray[0].UserType);\r\n            localStorage.setItem(\"IsTransporterMaster\", response.data.ResultArray[0].IsTransporterMaster);\r\n            localStorage.setItem(\"IsTeamMember\", response.data.ResultArray[0].IsTeamMember);\r\n\r\n            /* const socket = io(\"http://46.253.93.4:5000\");\r\n            socket.emit(\"addUpdateUser\", localStorage.getItem(\"userId\"), localStorage.getItem(\"UserType\")); */\r\n\r\n            ////////////////////////////\r\n\r\n            requestPermission();\r\n\r\n            ////////////////////////////\r\n\r\n            return true;\r\n        })\r\n        .catch((error) => {\r\n            console.log(error);\r\n        });\r\n};\r\n"]},"metadata":{},"sourceType":"module"}